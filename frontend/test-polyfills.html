<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyfills Test - MegaVibe</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>MegaVibe Polyfills Test</h1>
    <div id="test-results"></div>
    
    <script type="module">
        const testResults = document.getElementById('test-results');
        
        function addResult(html) {
            testResults.innerHTML += html;
        }
        
        // Test 1: Crypto Polyfill
        addResult('<div class="test-section"><h2>ğŸ” Crypto Tests</h2>');
        try {
            if (typeof crypto !== 'undefined') {
                addResult('<p class="success">âœ… Global crypto is available</p>');
                
                if (crypto.getRandomValues) {
                    const randomArray = new Uint8Array(16);
                    crypto.getRandomValues(randomArray);
                    addResult('<p class="success">âœ… crypto.getRandomValues() works</p>');
                } else {
                    addResult('<p class="error">âŒ crypto.getRandomValues() NOT available</p>');
                }
                
                if (crypto.subtle) {
                    addResult('<p class="success">âœ… crypto.subtle is available</p>');
                } else {
                    addResult('<p class="warning">âš ï¸ crypto.subtle is NOT available (might be polyfilled)</p>');
                }
            } else {
                addResult('<p class="error">âŒ Global crypto is NOT available</p>');
            }
        } catch (error) {
            addResult(`<p class="error">âŒ Crypto test error: ${error.message}</p>`);
        }
        addResult('</div>');
        
        // Test 2: EventEmitter Tests
        addResult('<div class="test-section"><h2>ğŸ“¡ EventEmitter Tests</h2>');
        try {
            if (typeof EventEmitter !== 'undefined') {
                addResult('<p class="success">âœ… Global EventEmitter is available</p>');
                
                // Test creating an EventEmitter instance
                const emitter = new EventEmitter();
                if (emitter) {
                    addResult('<p class="success">âœ… Can create EventEmitter instance</p>');
                    
                    // Test basic event functionality
                    let eventFired = false;
                    emitter.on('test', () => { eventFired = true; });
                    emitter.emit('test');
                    
                    if (eventFired) {
                        addResult('<p class="success">âœ… EventEmitter events work</p>');
                    } else {
                        addResult('<p class="error">âŒ EventEmitter events not working</p>');
                    }
                }
            } else {
                addResult('<p class="error">âŒ Global EventEmitter is NOT available</p>');
            }
            
            // Test events module
            if (typeof events !== 'undefined') {
                addResult('<p class="success">âœ… Global events module is available</p>');
                if (events.EventEmitter) {
                    addResult('<p class="success">âœ… events.EventEmitter is available</p>');
                }
            } else {
                addResult('<p class="warning">âš ï¸ Global events module is NOT available</p>');
            }
            
        } catch (error) {
            addResult(`<p class="error">âŒ EventEmitter test error: ${error.message}</p>`);
        }
        addResult('</div>');
        
        // Test 3: Other Node.js Polyfills
        addResult('<div class="test-section"><h2>ğŸ”§ Other Node.js Polyfills</h2>');
        try {
            if (typeof Buffer !== 'undefined') {
                addResult('<p class="success">âœ… Global Buffer is available</p>');
                const buffer = Buffer.from('hello');
                if (buffer) {
                    addResult('<p class="success">âœ… Buffer.from() works</p>');
                }
            } else {
                addResult('<p class="error">âŒ Global Buffer is NOT available</p>');
            }
            
            if (typeof process !== 'undefined') {
                addResult('<p class="success">âœ… Global process is available</p>');
                if (process.env !== undefined) {
                    addResult('<p class="success">âœ… process.env is available</p>');
                }
            } else {
                addResult('<p class="error">âŒ Global process is NOT available</p>');
            }
            
        } catch (error) {
            addResult(`<p class="error">âŒ Other polyfills test error: ${error.message}</p>`);
        }
        addResult('</div>');
        
        // Test 4: Module Resolution
        addResult('<div class="test-section"><h2>ğŸ“¦ Module Resolution Tests</h2>');
        try {
            // Test that we can import from the polyfilled modules without errors
            addResult('<p class="success">âœ… Module imports successful (no crypto/events import errors)</p>');
            addResult('<p class="success">âœ… Polyfills loaded before other modules</p>');
            
        } catch (error) {
            addResult(`<p class="error">âŒ Module resolution error: ${error.message}</p>`);
        }
        addResult('</div>');
        
        // Final Summary
        const errors = testResults.querySelectorAll('.error').length;
        const warnings = testResults.querySelectorAll('.warning').length;
        const successes = testResults.querySelectorAll('.success').length;
        
        addResult('<div class="test-section">');
        addResult(`<h2>ğŸ“Š Test Summary</h2>`);
        addResult(`<p><strong>âœ… Successes: ${successes}</strong></p>`);
        addResult(`<p><strong>âš ï¸ Warnings: ${warnings}</strong></p>`);
        addResult(`<p><strong>âŒ Errors: ${errors}</strong></p>`);
        
        if (errors === 0) {
            addResult('<p class="success"><strong>ğŸ‰ All critical tests passed! Your polyfills are working correctly.</strong></p>');
        } else {
            addResult('<p class="error"><strong>ğŸš¨ Some tests failed. Check the errors above.</strong></p>');
        }
        addResult('</div>');
        
    </script>
</body>
</html>